txPowerD2D = 26; % dBm
txPowerCell = 26;
gainVecD2D = [-1.71848
-1.33075
-1.66351
-1.15556
-1.14968
-1.49426
-1.08641
-1.4578
-1.32932
-1.6108
-1.71848
-1.33075
-1.66351
-1.15556
-1.14968
-1.49426
-1.08641
-1.4578
-1.32932
-1.6108
-1.9832
-1.59547
-1.92824
-1.42028
-1.4144
-1.75898
-1.35113
-1.72252
-1.59404
-1.87553
-2.17103
-1.7833
-2.11606
-1.6081
-1.60222
-1.9468
-1.53895
-1.91034
-1.78186
-2.06335
-2.31671
-1.92899
-2.26175
-1.75379
-1.74791
-2.09249
-1.68464
-2.05603
-1.92755
-2.20904
-2.43575
-2.04802
-2.38078
-1.87282
-1.86695
-2.21152
-1.80368
-2.17506
-2.04659
-2.32807
-2.53639
-2.14866
-2.48142
-1.97347
-1.96759
-2.31217
-1.90432
-2.27571
-2.14723
-2.42871
-2.62357
-2.23584
-2.5686
-2.06065
-2.05477
-2.39935
-1.9915
-2.36289
-2.23441
-2.51589
-2.70047
-2.31274
-2.6455
-2.13755
-2.13167
-2.47625
-2.0684
-2.43979
-2.31131
-2.59279
-2.76926
-2.38153
-2.71429
-2.20633
-2.20046
-2.54503
-2.13719
-2.50857
-2.3801
-2.66158
-2.83149
-2.44376
-2.77652
-2.26856
-2.26268
-2.60726
-2.19941
-2.5708
-2.44232
-2.72381
-2.88829
-2.50057
-2.83333
-2.32537
-2.31949
-2.66407
-2.25622
-2.62761
-2.49913
-2.78062
-2.94055
-2.55282
-2.88559
-2.37763
-2.37175
-2.71633
-2.30848
-2.67987
-2.55139
-2.83287
-2.98894
-2.60121
-2.93397
-2.42601
-2.42013
-2.76471
-2.35686
-2.72825
-2.59977
-2.88126
-3.03398
-2.64625
-2.97901
-2.47106
-2.46518
-2.80976
-2.40191
-2.7733
-2.64482
-2.9263
-3.07612
-2.68839
-3.02115
-2.51319
-2.50731
-2.85189
-2.44405
-2.81543
-2.68695
-2.96844
-3.1157
-2.72797
-3.06073
-2.55277
-2.5469
-2.89147
-2.48363
-2.85501
-2.72654
-3.00802
-3.15302
-2.76529
-3.09805
-2.59009
-2.58421
-2.92879
-2.52094
-2.89233
-2.76385
-3.04534
-3.18832
-2.80059
-3.13335
-2.62539
-2.61951
-2.96409
-2.55624
-2.92763
-2.79915
-3.08064
-3.2218
-2.83408
-3.16684
-2.65888
-2.653
-2.99758
-2.58973
-2.96112
-2.83264
-3.11413];

gainVecCell = [
    -1.24415
-1.31168
-1.77534
-1.17666
-1.25716
-1.68433
-1.22581
-1.48254
-1.44824
-1.0496
-1.24415
-1.31168
-1.77534
-1.17666
-1.25716
-1.68433
-1.22581
-1.48254
-1.44824
-1.0496
-1.50887
-1.5764
-2.04006
-1.44138
-1.52188
-1.94905
-1.49053
-1.74726
-1.71296
-1.31432
-1.6967
-1.76422
-2.22788
-1.6292
-1.70971
-2.13688
-1.67836
-1.93509
-1.90079
-1.50215
-1.84238
-1.90991
-2.37357
-1.77489
-1.85539
-2.28256
-1.82405
-2.08077
-2.04647
-1.64783
-1.96142
-2.02894
-2.4926
-1.89392
-1.97443
-2.4016
-1.94308
-2.19981
-2.16551
-1.76687
-2.06206
-2.12959
-2.59325
-1.99456
-2.07507
-2.50224
-2.04372
-2.30045
-2.26615
-1.86751
-2.14924
-2.21677
-2.68043
-2.08175
-2.16225
-2.58942
-2.1309
-2.38763
-2.35333
-1.95469
-2.22614
-2.29367
-2.75733
-2.15864
-2.23915
-2.66632
-2.2078
-2.46453
-2.43023
-2.03159
-2.29493
-2.36245
-2.82611
-2.22743
-2.30794
-2.73511
-2.27659
-2.53332
-2.49902
-2.10038
-2.35716
-2.42468
-2.88834
-2.28966
-2.37017
-2.79734
-2.33882
-2.59554
-2.56125
-2.1626
-2.41396
-2.48149
-2.94515
-2.34647
-2.42697
-2.85414
-2.39563
-2.65235
-2.61805
-2.21941
-2.46622
-2.53375
-2.99741
-2.39873
-2.47923
-2.9064
-2.44788
-2.70461
-2.67031
-2.27167
-2.51461
-2.58213
-3.04579
-2.44711
-2.52762
-2.95479
-2.49627
-2.753
-2.7187
-2.32006
-2.55965
-2.62718
-3.09084
-2.49215
-2.57266
-2.99983
-2.54131
-2.79804
-2.76374
-2.3651
-2.60179
-2.66931
-3.13297
-2.53429
-2.6148
-3.04197
-2.58345
-2.84018
-2.80588
-2.40724
-2.64137
-2.70889
-3.17255
-2.57387
-2.65438
-3.08155
-2.62303
-2.87976
-2.84546
-2.44682
-2.67869
-2.74621
-3.20987
-2.61119
-2.6917
-3.11887
-2.66035
-2.91707
-2.88278
-2.48413
-2.71399
-2.78151
-3.24517
-2.64649
-2.727
-3.15417
-2.69565
-2.95237
-2.91808
-2.51943
-2.74748
-2.815
-3.27866
-2.67998
-2.76048
-3.18765
-2.72914
-2.98586
-2.95156
-2.55292
];

% Get confidence intervals D2D.
numReps = 10;
gainVecD2DMean = [];
gainVecD2DNeg = [];
gainVecD2DPos = [];
for i = 1:numReps:size(gainVecD2D, 1)
    j = i+(numReps-1);
    ci = getCI(gainVecD2D(i:j), 0.95);
    gainVecD2DMean(end + 1) = mean(gainVecD2D(i:j));
    gainVecD2DNeg(end + 1) = ci(3);
    gainVecD2DPos(end + 1) = ci(3);
end

% Get confidence intervals cellular.
gainVecCellMean = [];
gainVecCellNeg = [];
gainVecCellPos = [];
for i = 1:numReps:size(gainVecCell, 1)
    j = i+(numReps-1);
    ci = getCI(gainVecCell(i:j), 0.95);
    gainVecCellMean(end + 1) = mean(gainVecCell(i:j));
    gainVecCellNeg(end + 1) = ci(3);
    gainVecCellPos(end + 1) = ci(3);
end

% Get confidence intervals eNodeB.
gainVecCellENBMean = [];
gainVecCellENBNeg = [];
gainVecCEllENBPos = [];
for i = 1:numReps:size(gainVecCellEnb, 1)
    j = i+(numReps-1);
    ci = getCI(gainVecCellEnb(i:j), 0.95);
    gainVecCellENBMean(end + 1) = mean(gainVecCellEnb(i:j));
    gainVecCellENBNeg(end + 1) = ci(3);
    gainVecCEllENBPos(end + 1) = ci(3);
end

distanceVec = 5:5:100;

figure;
hold on;
errorbar(distanceVec, gainVecD2DMean, gainVecD2DNeg, gainVecD2DPos);
errorbar(distanceVec, gainVecCellMean, gainVecCellNeg, gainVecCellPos);
errorbar(distanceVec, gainVecCellENBMean, gainVecCellENBNeg, gainVecCEllENBPos);

xlabel('distance [m]');
ylabel('channel gain');
title('Channel gain between UEs as reported by simuLTE');
legend({'D2D pair, txPower=26dBm', 'Cellular pair, txPower=26dBm'});
set(gca,'FontSize', 26);

hold off;