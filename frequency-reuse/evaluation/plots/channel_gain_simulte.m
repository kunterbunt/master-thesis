txPowerD2D = 26; % dBm
txPowerCell = 26;
gainD2DVec = [-1.71848
-1.33075
-1.66351
-1.15556
-1.14968
-1.49426
-1.08641
-1.4578
-1.32932
-1.6108
-1.71848
-1.33075
-1.66351
-1.15556
-1.14968
-1.49426
-1.08641
-1.4578
-1.32932
-1.6108
-1.9832
-1.59547
-1.92824
-1.42028
-1.4144
-1.75898
-1.35113
-1.72252
-1.59404
-1.87553
-2.17103
-1.7833
-2.11606
-1.6081
-1.60222
-1.9468
-1.53895
-1.91034
-1.78186
-2.06335
-2.31671
-1.92899
-2.26175
-1.75379
-1.74791
-2.09249
-1.68464
-2.05603
-1.92755
-2.20904
-2.43575
-2.04802
-2.38078
-1.87282
-1.86695
-2.21152
-1.80368
-2.17506
-2.04659
-2.32807
-2.53639
-2.14866
-2.48142
-1.97347
-1.96759
-2.31217
-1.90432
-2.27571
-2.14723
-2.42871
-2.62357
-2.23584
-2.5686
-2.06065
-2.05477
-2.39935
-1.9915
-2.36289
-2.23441
-2.51589
-2.70047
-2.31274
-2.6455
-2.13755
-2.13167
-2.47625
-2.0684
-2.43979
-2.31131
-2.59279
-2.76926
-2.38153
-2.71429
-2.20633
-2.20046
-2.54503
-2.13719
-2.50857
-2.3801
-2.66158
-2.83149
-2.44376
-2.77652
-2.26856
-2.26268
-2.60726
-2.19941
-2.5708
-2.44232
-2.72381
-2.88829
-2.50057
-2.83333
-2.32537
-2.31949
-2.66407
-2.25622
-2.62761
-2.49913
-2.78062
-2.94055
-2.55282
-2.88559
-2.37763
-2.37175
-2.71633
-2.30848
-2.67987
-2.55139
-2.83287
-2.98894
-2.60121
-2.93397
-2.42601
-2.42013
-2.76471
-2.35686
-2.72825
-2.59977
-2.88126
-3.03398
-2.64625
-2.97901
-2.47106
-2.46518
-2.80976
-2.40191
-2.7733
-2.64482
-2.9263
-3.07612
-2.68839
-3.02115
-2.51319
-2.50731
-2.85189
-2.44405
-2.81543
-2.68695
-2.96844
-3.1157
-2.72797
-3.06073
-2.55277
-2.5469
-2.89147
-2.48363
-2.85501
-2.72654
-3.00802
-3.15302
-2.76529
-3.09805
-2.59009
-2.58421
-2.92879
-2.52094
-2.89233
-2.76385
-3.04534
-3.18832
-2.80059
-3.13335
-2.62539
-2.61951
-2.96409
-2.55624
-2.92763
-2.79915
-3.08064
-3.2218
-2.83408
-3.16684
-2.65888
-2.653
-2.99758
-2.58973
-2.96112
-2.83264
-3.11413];

gainCellVec = [
    -1.24415
-1.31168
-1.77534
-1.17666
-1.25716
-1.68433
-1.22581
-1.48254
-1.44824
-1.0496
-1.24415
-1.31168
-1.77534
-1.17666
-1.25716
-1.68433
-1.22581
-1.48254
-1.44824
-1.0496
-1.50887
-1.5764
-2.04006
-1.44138
-1.52188
-1.94905
-1.49053
-1.74726
-1.71296
-1.31432
-1.6967
-1.76422
-2.22788
-1.6292
-1.70971
-2.13688
-1.67836
-1.93509
-1.90079
-1.50215
-1.84238
-1.90991
-2.37357
-1.77489
-1.85539
-2.28256
-1.82405
-2.08077
-2.04647
-1.64783
-1.96142
-2.02894
-2.4926
-1.89392
-1.97443
-2.4016
-1.94308
-2.19981
-2.16551
-1.76687
-2.06206
-2.12959
-2.59325
-1.99456
-2.07507
-2.50224
-2.04372
-2.30045
-2.26615
-1.86751
-2.14924
-2.21677
-2.68043
-2.08175
-2.16225
-2.58942
-2.1309
-2.38763
-2.35333
-1.95469
-2.22614
-2.29367
-2.75733
-2.15864
-2.23915
-2.66632
-2.2078
-2.46453
-2.43023
-2.03159
-2.29493
-2.36245
-2.82611
-2.22743
-2.30794
-2.73511
-2.27659
-2.53332
-2.49902
-2.10038
-2.35716
-2.42468
-2.88834
-2.28966
-2.37017
-2.79734
-2.33882
-2.59554
-2.56125
-2.1626
-2.41396
-2.48149
-2.94515
-2.34647
-2.42697
-2.85414
-2.39563
-2.65235
-2.61805
-2.21941
-2.46622
-2.53375
-2.99741
-2.39873
-2.47923
-2.9064
-2.44788
-2.70461
-2.67031
-2.27167
-2.51461
-2.58213
-3.04579
-2.44711
-2.52762
-2.95479
-2.49627
-2.753
-2.7187
-2.32006
-2.55965
-2.62718
-3.09084
-2.49215
-2.57266
-2.99983
-2.54131
-2.79804
-2.76374
-2.3651
-2.60179
-2.66931
-3.13297
-2.53429
-2.6148
-3.04197
-2.58345
-2.84018
-2.80588
-2.40724
-2.64137
-2.70889
-3.17255
-2.57387
-2.65438
-3.08155
-2.62303
-2.87976
-2.84546
-2.44682
-2.67869
-2.74621
-3.20987
-2.61119
-2.6917
-3.11887
-2.66035
-2.91707
-2.88278
-2.48413
-2.71399
-2.78151
-3.24517
-2.64649
-2.727
-3.15417
-2.69565
-2.95237
-2.91808
-2.51943
-2.74748
-2.815
-3.27866
-2.67998
-2.76048
-3.18765
-2.72914
-2.98586
-2.95156
-2.55292
];

gainCellEnbVec = [
-0.351094
-0.641652
-0.804883
-0.774659
-0.474313
-0.690972
-0.437085
-0.860398
-0.615448
-0.932928
-0.351094
-0.641652
-0.804883
-0.774659
-0.474313
-0.690972
-0.437085
-0.860398
-0.615448
-0.932928
-0.615815
-0.906374
-1.0696
-1.03938
-0.739035
-0.955694
-0.701807
-1.12512
-0.88017
-1.19765
-0.803639
-1.0942
-1.25743
-1.2272
-0.926858
-1.14352
-0.889631
-1.31294
-1.06799
-1.38547
-0.949326
-1.23988
-1.40311
-1.37289
-1.07255
-1.2892
-1.03532
-1.45863
-1.21368
-1.53116
-1.06836
-1.35892
-1.52215
-1.49193
-1.19158
-1.40824
-1.15435
-1.57766
-1.33271
-1.65019
-1.169
-1.45956
-1.62279
-1.59257
-1.29222
-1.50888
-1.255
-1.67831
-1.43336
-1.75084
-1.25618
-1.54674
-1.70997
-1.67975
-1.3794
-1.59606
-1.34218
-1.76549
-1.52054
-1.83802
-1.33308
-1.62364
-1.78687
-1.75665
-1.4563
-1.67296
-1.41907
-1.84239
-1.59744
-1.91492
-1.40187
-1.69243
-1.85566
-1.82544
-1.52509
-1.74175
-1.48786
-1.91117
-1.66622
-1.9837
-1.4641
-1.75466
-1.91789
-1.88766
-1.58732
-1.80398
-1.55009
-1.9734
-1.72845
-2.04593
-1.52091
-1.81146
-1.97469
-1.94447
-1.64413
-1.86078
-1.6069
-2.03021
-1.78526
-2.10274
-1.57316
-1.86372
-2.02695
-1.99673
-1.69638
-1.91304
-1.65916
-2.08247
-1.83752
-2.155
-1.62155
-1.91211
-2.07534
-2.04511
-1.74477
-1.96143
-1.70754
-2.13085
-1.8859
-2.20338
-1.66659
-1.95715
-2.12038
-2.09016
-1.78981
-2.00647
-1.75258
-2.1759
-1.93095
-2.24843
-1.70873
-1.99929
-2.16252
-2.13229
-1.83195
-2.04861
-1.79472
-2.21803
-1.97308
-2.29056
-1.74831
-2.03887
-2.2021
-2.17188
-1.87153
-2.08819
-1.8343
-2.25761
-2.01266
-2.33014
-1.78563
-2.07619
-2.23942
-2.20919
-1.90885
-2.12551
-1.87162
-2.29493
-2.04998
-2.36746
-1.82093
-2.11149
-2.27472
-2.24449
-1.94415
-2.16081
-1.90692
-2.33023
-2.08528
-2.40276
-1.85442
-2.14497
-2.30821
-2.27798
-1.97764
-2.19429
-1.94041
-2.36372
-2.11877
-2.43625
];
gainEnbCellVec = [
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
-0.752031
-0.891477
-0.868667
-0.898143
-0.801776
-0.758242
-0.619384
-0.924643
-0.728062
-0.902006
];

% Get confidence intervals D2D.
numReps = 10;
gainD2DMeanVec = [];
gainD2DNegVec = [];
gainD2DPosVec = [];
for i = 1:numReps:size(gainD2DVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainD2DVec(i:j), 0.95);
    gainD2DMeanVec(end + 1) = mean(gainD2DVec(i:j));
    gainD2DNegVec(end + 1) = ci(3);
    gainD2DPosVec(end + 1) = ci(3);
end

% Get confidence intervals cellular.
gainCellMeanVec = [];
gainCellNegVec = [];
gainCellPosVec = [];
for i = 1:numReps:size(gainCellVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainCellVec(i:j), 0.95);
    gainCellMeanVec(end + 1) = mean(gainCellVec(i:j));
    gainCellNegVec(end + 1) = ci(3);
    gainCellPosVec(end + 1) = ci(3);
end

% Get confidence intervals UE->eNodeB.
gainCellEnbMeanVec = [];
gainCellEnbNegVec = [];
gainCellEnbPosVec = [];
for i = 1:numReps:size(gainCellEnbVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainCellEnbVec(i:j), 0.95);
    gainCellEnbMeanVec(end + 1) = mean(gainCellEnbVec(i:j));
    gainCellEnbNegVec(end + 1) = ci(3);
    gainCellEnbPosVec(end + 1) = ci(3);
end

% Get confidence intervals eNodeB->UE.
gainEnbCellMeanVec = [];
gainEnbCellNegVec = [];
gainEnbCellPosVec = [];
for i = 1:numReps:size(gainEnbCellVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainEnbCellVec(i:j), 0.95);
    gainEnbCellMeanVec(end + 1) = mean(gainEnbCellVec(i:j));
    gainEnbCellNegVec(end + 1) = ci(3);
    gainEnbCellPosVec(end + 1) = ci(3);
end

distanceVec = 5:5:100;

figure;
hold on;
errorbar(distanceVec, gainD2DMeanVec, gainD2DNegVec, gainD2DPosVec);
% errorbar(distanceVec, gainVecCellMean, gainVecCellNeg, gainVecCellPos);
errorbar(distanceVec, gainCellEnbMeanVec, gainCellEnbNegVec, gainCellEnbPosVec);
errorbar(distanceVec, gainEnbCellMeanVec, gainEnbCellNegVec, gainEnbCellPosVec);

xlabel('distance [m]');
ylabel('channel gain');
title('Channel gain between nodes as reported by simuLTE.');
%legend({'D2D pair', 'Cellular pair', 'UE to eNodeB'});
legend({'UE to UE', 'UE to eNodeB', 'eNodeB to UE'});
set(gca,'FontSize', 26);

hold off;