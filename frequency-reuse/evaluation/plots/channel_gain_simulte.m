txPowerD2D = 26; % dBm
txPowerCell = 26;
gainD2DVec = [
8.5496e-08
8.71048e-07
1.18813e-07
2.48629e-06
2.57533e-06
3.27289e-07
3.76127e-06
4.07127e-07
8.78556e-07
1.62896e-07
8.5496e-08
8.71048e-07
1.18813e-07
2.48629e-06
2.57533e-06
3.27289e-07
3.76127e-06
4.07127e-07
8.78556e-07
1.62896e-07
1.75254e-08
1.78552e-07
2.43549e-08
5.09653e-07
5.27906e-07
6.70895e-08
7.71006e-07
8.34551e-08
1.80091e-07
3.33913e-08
5.69283e-09
5.79996e-08
7.91127e-09
1.65552e-07
1.71481e-07
2.17929e-08
2.50448e-07
2.71089e-08
5.84995e-08
1.08466e-08
2.37981e-09
2.42459e-08
3.3072e-09
6.92067e-08
7.16853e-08
9.1102e-09
1.04696e-07
1.13325e-08
2.44549e-08
4.53426e-09
1.16695e-09
1.18891e-08
1.62169e-09
3.39357e-08
3.51511e-08
4.46722e-09
5.13381e-08
5.55694e-09
1.19915e-08
2.22339e-09
6.38823e-10
6.50844e-09
8.87765e-10
1.85775e-08
1.92428e-08
2.44549e-09
2.81041e-08
3.04204e-09
6.56454e-09
1.21715e-09
3.79063e-10
3.86195e-09
5.26779e-10
1.10234e-08
1.14182e-08
1.4511e-09
1.66763e-08
1.80507e-09
3.89524e-09
7.2223e-10
2.39207e-10
2.43708e-09
3.32424e-10
6.95633e-09
7.20546e-09
9.15714e-10
1.05236e-08
1.13909e-09
2.45809e-09
4.55763e-10
1.58462e-10
1.61444e-09
2.20213e-10
4.60819e-09
4.77323e-09
6.06611e-10
6.9713e-09
7.54586e-10
1.62835e-09
3.01918e-10
1.09178e-10
1.11233e-09
1.51724e-10
3.17498e-09
3.28869e-09
4.17947e-10
4.80313e-09
5.199e-10
1.12191e-09
2.08018e-10
7.77023e-11
7.91644e-10
1.07982e-10
2.25964e-09
2.34057e-09
2.97454e-10
3.4184e-09
3.70014e-10
7.98468e-10
1.48047e-10
5.68279e-11
5.78972e-10
7.89731e-11
1.6526e-09
1.71178e-09
2.17544e-10
2.50006e-09
2.70611e-10
5.83963e-10
1.08274e-10
4.25366e-11
4.3337e-10
5.91127e-11
1.237e-09
1.2813e-09
1.62835e-10
1.87134e-09
2.02557e-10
4.37106e-10
8.10453e-11
3.24824e-11
3.30936e-10
4.51404e-11
9.44612e-10
9.78443e-10
1.24346e-10
1.42901e-09
1.54679e-10
3.33789e-10
6.18888e-11
2.52402e-11
2.57152e-10
3.50761e-11
7.34005e-10
7.60293e-10
9.66227e-11
1.11041e-09
1.20193e-10
2.59369e-10
4.80904e-11
1.99151e-11
2.02899e-10
2.76758e-11
5.79147e-10
5.99889e-10
7.62376e-11
8.76137e-10
9.48347e-11
2.04648e-10
3.79444e-11
1.59278e-11
1.62276e-10
2.21347e-11
4.63193e-10
4.79783e-10
6.09737e-11
7.00722e-10
7.58474e-11
1.63674e-10
3.03474e-11
1.28937e-11
1.31363e-10
1.79182e-11
3.74959e-10
3.88388e-10
4.93587e-11
5.6724e-10
6.13991e-11
1.32496e-10
2.45664e-11
1.05513e-11
1.07499e-10
1.46631e-11
3.06841e-10
3.1783e-10
4.03918e-11
4.6419e-10
5.02448e-11
1.08425e-10
2.01035e-11
];

gainCellVec = [
1.46286e-06
9.7643e-07
6.08311e-08
2.19127e-06
1.35325e-06
1.04891e-07
1.63262e-06
3.51071e-07
4.31092e-07
4.68855e-06
1.46286e-06
9.7643e-07
6.08311e-08
2.19127e-06
1.35325e-06
1.04891e-07
1.63262e-06
3.51071e-07
4.31092e-07
4.68855e-06
2.99865e-07
2.00154e-07
1.24695e-08
4.49179e-07
2.77397e-07
2.15011e-08
3.34664e-07
7.19645e-08
8.83676e-08
9.61085e-07
9.7406e-08
6.50165e-08
4.05049e-09
1.45908e-07
9.01075e-08
6.98425e-09
1.0871e-07
2.33764e-08
2.87047e-08
3.12192e-07
4.07192e-08
2.71792e-08
1.69325e-09
6.09948e-08
3.76682e-08
2.91967e-09
4.54446e-08
9.77219e-09
1.19996e-08
1.30507e-07
1.99668e-08
1.33274e-08
8.30292e-10
2.9909e-08
1.84707e-08
1.43167e-09
2.22839e-08
4.79182e-09
5.88404e-09
6.39947e-08
1.09304e-08
7.29585e-09
4.54527e-10
1.63731e-08
1.01114e-08
7.83739e-10
1.21989e-08
2.62319e-09
3.22111e-09
3.50327e-08
6.48587e-09
4.32918e-09
2.69706e-10
9.71542e-09
5.99989e-09
4.65053e-10
7.23854e-09
1.55654e-09
1.91133e-09
2.07876e-08
4.09291e-09
2.73193e-09
1.70198e-10
6.13091e-09
3.78623e-09
2.93471e-10
4.56788e-09
9.82254e-10
1.20614e-09
1.3118e-08
2.71133e-09
1.80976e-09
1.12747e-10
4.0614e-09
2.50817e-09
1.94409e-10
3.02597e-09
6.5069e-10
7.99004e-10
8.68996e-09
1.86807e-09
1.2469e-09
7.76811e-11
2.79825e-09
1.7281e-09
1.33945e-10
2.08486e-09
4.48317e-10
5.50504e-10
5.98727e-09
1.32951e-09
8.87419e-10
5.52858e-11
1.99152e-09
1.22989e-09
9.5329e-11
1.4838e-09
3.19068e-10
3.91794e-10
4.26115e-09
9.72341e-10
6.49018e-10
4.04335e-11
1.4565e-09
8.99484e-10
6.97192e-11
1.08518e-09
2.33352e-10
2.8654e-10
3.11641e-09
7.27814e-10
4.85801e-10
3.02651e-11
1.09022e-09
6.73279e-10
5.2186e-11
8.12275e-10
1.74668e-10
2.1448e-10
2.33268e-09
5.55783e-10
3.70973e-10
2.31115e-11
8.32527e-10
5.14138e-10
3.9851e-11
6.2028e-10
1.33382e-10
1.63784e-10
1.78131e-09
4.31868e-10
2.88263e-10
1.79586e-11
6.4691e-10
3.99508e-10
3.0966e-11
4.81985e-10
1.03644e-10
1.27268e-10
1.38416e-09
3.40754e-10
2.27446e-10
1.41698e-11
5.10427e-10
3.15221e-10
2.44329e-11
3.80297e-10
8.17773e-11
1.00417e-10
1.09213e-09
2.7253e-10
1.81908e-10
1.13328e-11
4.08232e-10
2.52109e-10
1.95411e-11
3.04156e-10
6.54043e-11
8.03121e-11
8.73473e-10
2.20615e-10
1.47256e-10
9.17397e-12
3.30467e-10
2.04084e-10
1.58186e-11
2.46217e-10
5.29453e-11
6.50133e-11
7.07083e-10
1.80536e-10
1.20504e-10
7.50735e-12
2.70432e-10
1.67009e-10
1.29449e-11
2.01487e-10
4.33268e-11
5.32025e-11
5.78629e-10
];

gainCellEnbVec = [
3.07013e-06
5.39145e-07
2.02911e-07
2.43156e-07
1.4682e-06
4.01304e-07
1.83475e-06
1.45535e-07
6.3072e-07
9.42732e-08
3.07013e-06
5.39145e-07
2.02911e-07
2.43156e-07
1.4682e-06
4.01304e-07
1.83475e-06
1.45535e-07
6.3072e-07
9.42732e-08
6.29332e-07
1.10517e-07
4.15938e-08
4.98435e-08
3.0096e-07
8.22615e-08
3.76098e-07
2.98325e-08
1.29288e-07
1.93246e-08
2.04428e-07
3.58995e-08
1.3511e-08
1.61908e-08
9.77615e-08
2.67212e-08
1.22169e-07
9.69056e-09
4.19971e-08
6.27727e-09
8.54581e-08
1.50073e-08
5.64809e-09
6.76834e-09
4.08678e-08
1.11704e-08
5.1071e-08
4.051e-09
1.75563e-08
2.62413e-09
4.19047e-08
7.35887e-09
2.76956e-09
3.31888e-09
2.00397e-08
5.47746e-09
2.50428e-08
1.98642e-09
8.60878e-09
1.28675e-09
2.29399e-08
4.02847e-09
1.51614e-09
1.81685e-09
1.09703e-08
2.99853e-09
1.37092e-08
1.08743e-09
4.71271e-09
7.04406e-10
1.3612e-08
2.3904e-09
8.99644e-10
1.07808e-09
6.50954e-09
1.77926e-09
8.13472e-09
6.45255e-10
2.79641e-09
4.17978e-10
8.58984e-09
1.50846e-09
5.6772e-10
6.80321e-10
4.10784e-09
1.1228e-09
5.13341e-09
4.07188e-10
1.76467e-09
2.63765e-10
5.69031e-09
9.99274e-10
3.76084e-10
4.50676e-10
2.72122e-09
7.43794e-10
3.40061e-09
2.6974e-10
1.169e-09
1.7473e-10
3.92055e-09
6.88486e-10
2.59117e-10
3.1051e-10
1.87489e-09
5.12464e-10
2.34297e-09
1.85847e-10
8.05427e-10
1.20387e-10
2.79026e-09
4.89997e-10
1.84414e-10
2.2099e-10
1.33436e-09
3.64722e-10
1.6675e-09
1.32268e-10
5.73224e-10
8.56794e-11
2.04067e-09
3.58361e-10
1.34872e-10
1.61622e-10
9.7589e-10
2.66741e-10
1.21953e-09
9.67346e-11
4.19229e-10
6.26619e-11
1.52747e-09
2.6824e-10
1.00954e-10
1.20977e-10
7.3047e-10
1.9966e-10
9.12841e-10
7.24075e-11
3.138e-10
4.69035e-11
1.16643e-09
2.04837e-10
7.70916e-11
9.2382e-11
5.57811e-10
1.52467e-10
6.97075e-10
5.52928e-11
2.39628e-10
3.58171e-11
9.06368e-10
1.59167e-10
5.99036e-11
7.17849e-11
4.33444e-10
1.18474e-10
5.41658e-10
4.29649e-11
1.86202e-10
2.78315e-11
7.15145e-10
1.25586e-10
4.72653e-11
5.664e-11
3.41997e-10
9.34784e-11
4.27381e-10
3.39003e-11
1.46918e-10
2.19597e-11
5.71963e-10
1.00442e-10
3.78021e-11
4.52998e-11
2.73525e-10
7.47627e-11
3.41813e-10
2.7113e-11
1.17503e-10
1.7563e-11
4.63008e-10
8.13088e-11
3.06011e-11
3.66705e-11
2.2142e-10
6.05209e-11
2.767e-10
2.19482e-11
9.51192e-11
1.42174e-11
3.78894e-10
6.65376e-11
2.50419e-11
3.00087e-11
1.81195e-10
4.95262e-11
2.26433e-10
1.79609e-11
7.78391e-11
1.16346e-11

];
gainEnbCellVec = [
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
8.72286e-07
1.99162e-07
2.53591e-07
1.85585e-07
5.15026e-07
8.16746e-07
3.55494e-06
1.40166e-07
1.12439e-06
1.78145e-07
];

% Get confidence intervals D2D.
numReps = 10;
gainD2DMeanVec = [];
gainD2DNegVec = [];
gainD2DPosVec = [];
for i = 1:numReps:size(gainD2DVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainD2DVec(i:j), 0.95);
    gainD2DMeanVec(end + 1) = mean(gainD2DVec(i:j));
    gainD2DNegVec(end + 1) = ci(3);
    gainD2DPosVec(end + 1) = ci(3);
end

gainD2DMeandBVec = [];
gainD2DNegdBVec = [];
gainD2DPosdBVec = [];
for i = 1:numReps:size(gainD2DVec, 1)
    j = i+(numReps-1);
    ci = getCI(10 * log10(gainD2DVec(i:j)), 0.95);
    gainD2DMeandBVec(end + 1) = mean(10 * log10(gainD2DVec(i:j)));
    gainD2DNegdBVec(end + 1) = ci(3);
    gainD2DPosdBVec(end + 1) = ci(3);
end

% Get confidence intervals cellular.
gainCellMeanVec = [];
gainCellNegVec = [];
gainCellPosVec = [];
for i = 1:numReps:size(gainCellVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainCellVec(i:j), 0.95);
    gainCellMeanVec(end + 1) = mean(gainCellVec(i:j));
    gainCellNegVec(end + 1) = ci(3);
    gainCellPosVec(end + 1) = ci(3);
end

% Get confidence intervals UE->eNodeB.
gainCellEnbMeanVec = [];
gainCellEnbNegVec = [];
gainCellEnbPosVec = [];
for i = 1:numReps:size(gainCellEnbVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainCellEnbVec(i:j), 0.95);
    gainCellEnbMeanVec(end + 1) = mean(gainCellEnbVec(i:j));
    gainCellEnbNegVec(end + 1) = ci(3);
    gainCellEnbPosVec(end + 1) = ci(3);
end

% Get confidence intervals eNodeB->UE.
gainEnbCellMeanVec = [];
gainEnbCellNegVec = [];
gainEnbCellPosVec = [];
for i = 1:numReps:size(gainEnbCellVec, 1)
    j = i+(numReps-1);
    ci = getCI(gainEnbCellVec(i:j), 0.95);
    gainEnbCellMeanVec(end + 1) = mean(gainEnbCellVec(i:j));
    gainEnbCellNegVec(end + 1) = ci(3);
    gainEnbCellPosVec(end + 1) = ci(3);
end

distanceVec = 5:5:100;

figure;
hold on;
yyaxis left;
ylabel('channel gain [linear]');
errorbar(distanceVec, gainD2DMeanVec, gainD2DNegVec, gainD2DPosVec);

yyaxis right;
ylabel('channel gain [dB]');
errorbar(distanceVec, gainD2DMeandBVec, gainD2DNegdBVec, gainD2DPosdBVec);
%errorbar(distanceVec, gainCellMeanVec, gainCellNegVec, gainCellPosVec);
%errorbar(distanceVec, gainCellEnbMeanVec, gainCellEnbNegVec, gainCellEnbPosVec);
%errorbar(distanceVec, gainEnbCellMeanVec, gainEnbCellNegVec, gainEnbCellPosVec);

xlabel('distance [m]');

title('Channel gain between two UEs in simuLTE.');
%legend({'D2D pair', 'Cellular pair', 'UE to eNodeB'});
set(gca,'FontSize', 26);

hold off;